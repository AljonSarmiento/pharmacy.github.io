<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Inventory</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-container {
            margin: 20px;
        }
        .btn-custom {
            width: 70px;
        }
        .form-control {
            display: inline-block;
            width: auto;
        }
        .modal input {
            width: 100%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container table-container">
        <h2>ANG-ANGCO PHARMACY</h2>
        <h2>Product Inventory</h2>
        <button class="btn btn-primary mb-3" id="addProductButton" data-toggle="modal" data-target="#productModal">Add Product</button>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Image</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Date Created</th>
                    <th>Publish Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="productTable">
                <!-- Table rows go here -->
            </tbody>
        </table>
    </div>

    <!-- Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalLabel">Add Product</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="productId">
                    <input type="text" id="productName" placeholder="Product Name">
                    <input type="file" id="productImage" accept="image/*">
                    <img id="imagePreview" src="" alt="Image Preview" width="50">
                    <input type="number" id="productPrice" placeholder="Price">
                    <input type="number" id="productStock" placeholder="Stock">
                    <input type="text" id="productDate" placeholder="Date Created" readonly>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveProduct">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        let products = [
            { id: "24-0001", image: "path/to/image1.jpg", name: "Sample 1", price: "Php 200.00", stock: 89, date: "2013-01-17 12:00:51 PM", status: "On" },
            { id: "24-0002", image: "path/to/image2.jpg", name: "Sample 2", price: "Php 100.00", stock: 10, date: "2013-01-17 11:59:28 AM", status: "On" }
        ];

        function generateProductId() {
            const currentDate = new Date();
            const year = currentDate.getFullYear().toString().substr(-2); // Get last two digits of the year
            const productNumber = (products.length + 1).toString().padStart(4, '0'); // Pad product number with leading zeros
            return `${year}-${productNumber}`;
        }

        function renderTable() {
            const tableBody = document.getElementById("productTable");
            tableBody.innerHTML = "";
            products.forEach(product => {
                const row = `
                    <tr>
                        <td>${product.id}</td>
                        <td><img src="${product.image}" alt="Image" width="50"></td>
                        <td>${product.name}</td>
                        <td>${product.price}</td>
                        <td>${product.stock}</td>
                        <td>${product.date}</td>
                        <td><button class="btn btn-${product.status === 'On' ? 'success' : 'secondary'} btn-sm" onclick="toggleStatus('${product.id}')">${product.status}</button></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="editProduct('${product.id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="confirmDelete('${product.id}')">Delete</button>
                        </td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML("beforeend", row);
            });
        }

        function toggleStatus(id) {
            const product = products.find(p => p.id === id);
            product.status = product.status === 'On' ? 'Off' : 'On';
            renderTable();
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            document.getElementById("productId").value = product.id;
            document.getElementById("productName").value = product.name;
            document.getElementById("imagePreview").src = product.image;
            document.getElementById("productPrice").value = product.price;
            document.getElementById("productStock").value = product.stock;
            document.getElementById("productDate").value = product.date;
            document.getElementById("productModalLabel").innerText = "Edit Product";
            $('#productModal').modal('show');
        }

        function confirmDelete(id) {
            if (confirm("Are you sure you want to delete this product?")) {
                deleteProduct(id);
            }
        }

        function deleteProduct(id) {
            products = products.filter(product => product.id !== id);
            renderTable();
        }

            document.getElementById("saveProduct").addEventListener("click", function() {
        const id = document.getElementById("productId").value || generateProductId(); // Generate ID if not provided
        const name = document.getElementById("productName").value;
        const image = document.getElementById("imagePreview").src;
        const price = 'Php ' + document.getElementById("productPrice").value;
        const stock = document.getElementById("productStock").value;
        const date = document.getElementById("productDate").value;

        if (id) {
            // Check if ID is provided
            const existingProductIndex = products.findIndex(p => p.id === id);
            if (existingProductIndex !== -1) {
                // Update existing product
                products[existingProductIndex].name = name;
                products[existingProductIndex].image = image;
                products[existingProductIndex].price = price;
                products[existingProductIndex].stock = stock;
                products[existingProductIndex].date = date;
            } else {
                // Add new product
                const newProduct = {
                    id,
                    name,
                    image,
                    price,
                    stock,
                    date,
                    status: "Off" // Default publish status is "Off"
                };
                products.push(newProduct);
            }
        }

        $('#productModal').modal('hide');
        renderTable();
    });


        $('#productModal').on('hidden.bs.modal', function (e) {
            document.getElementById("productId").value = "";
            document.getElementById("productName").value = "";
            document.getElementById("imagePreview").src = "";
            document.getElementById("productPrice").value = "";
            document.getElementById("productStock").value = "";
            document.getElementById("productDate").value = "";
            document.getElementById("productModalLabel").innerText = "Add Product";
        });

        document.getElementById("productImage").addEventListener("change", function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("imagePreview").src = e.target.result;
            }
            reader.readAsDataURL(file);
        });

        document.getElementById("addProductButton").addEventListener("click", function() {
            const currentDate = new Date();
            const formattedDate = currentDate.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            }).replace(/,/, '');
            document.getElementById("productDate").value = formattedDate;
        });

        // Initial render
        renderTable();
    </script>
</body>
</html>
